import React, { useState } from 'react';
import { 
  Bot, 
  MessageSquare, 
  List, 
  Link as LinkIcon, 
  Tag, 
  Settings, 
  Trash2, 
  Check, 
  Plus, 
  Edit3, 
  Send,
  PanelRightClose,
  PanelRightOpen,
  FileText,
  Search,
  Inbox
} from 'lucide-react';

const RightSidebarAI = () => {
  // 状态管理
  const [activeTab, setActiveTab] = useState('AI');
  const [aiMode, setAiMode] = useState('Agent');
  // 核心状态：内部的会话列表侧栏是否展开
  const [isListExpanded, setIsListExpanded] = useState(false); 
  const [inputText, setInputText] = useState('');
  
  // 模拟数据：增加 type 字段区分类型
  const historyItems = [
    { id: 1, title: '你好，帮我写个大纲', type: 'chat' },
    { id: 2, title: '关于React的优化建议', type: 'agent' },
    { id: 3, title: '未命名的对话 1', type: 'chat' },
    { id: 4, title: '解释量子纠缠', type: 'agent' },
  ];

  const navItems = [
    { id: 'AI', label: 'AI', icon: <Bot size={18} /> },
    { id: 'Outline', label: '大纲', icon: <List size={18} /> },
    { id: 'Links', label: '链接', icon: <LinkIcon size={18} /> },
    { id: 'Tags', label: '标签', icon: <Tag size={18} /> },
  ];

  return (
    <div className="flex h-screen w-full bg-gray-100 overflow-hidden font-sans">
      
      {/* --- 左侧主编辑区 (模拟) --- */}
      <div className="flex-1 flex flex-col items-center justify-center p-8 text-gray-400 border-r border-gray-200 bg-gray-50/50">
        <div className="text-center space-y-4">
          <FileText size={64} className="mx-auto text-gray-300" />
          <h2 className="text-xl font-medium text-gray-500">主笔记编辑区域</h2>
          <p className="text-sm">从左侧资源管理器选择笔记，或在右侧使用 AI 助手</p>
        </div>
      </div>

      {/* --- 右侧 AI 面板 (The Main Sidebar) --- */}
      <div className="w-[500px] bg-white flex flex-col shadow-2xl z-20 h-full">
        
        {/* 1. 顶部 Tab 导航 (固定不动) */}
        <div className="flex items-center justify-between px-4 py-3 border-b border-gray-100 bg-white z-10">
          <div className="flex gap-1">
            {navItems.map((item) => (
              <button
                key={item.id}
                onClick={() => setActiveTab(item.id)}
                className={`flex items-center gap-1.5 px-3 py-1.5 rounded-md transition-all duration-200 text-xs font-medium ${
                  activeTab === item.id 
                    ? 'text-blue-600 bg-blue-50' 
                    : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                }`}
              >
                {item.icon}
                <span>{item.label}</span>
              </button>
            ))}
          </div>
          {/* 右上角查询按钮已移除，保持干净 */}
        </div>

        {/* 主要内容区域：根据 Tab 切换 */}
        {activeTab === 'AI' ? (
          <>
            {/* 2. 二级控制区：Agent/对话 切换 */}
            <div className="px-4 py-3 border-b border-gray-50 flex items-center justify-between bg-white">
              {/* 胶囊切换器 */}
              <div className="bg-gray-100/80 p-1 rounded-lg inline-flex w-48">
                <button
                  onClick={() => setAiMode('Agent')}
                  className={`flex-1 flex items-center justify-center gap-1.5 py-1 px-2 rounded-md text-xs font-bold transition-all ${
                    aiMode === 'Agent' 
                      ? 'bg-white text-blue-600 shadow-sm' 
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  Agent
                </button>
                <button
                  onClick={() => setAiMode('对话')}
                  className={`flex-1 flex items-center justify-center gap-1.5 py-1 px-2 rounded-md text-xs font-bold transition-all ${
                    aiMode === '对话' 
                      ? 'bg-white text-blue-600 shadow-sm' 
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  对话
                </button>
              </div>

              {/* 右侧：状态指示 + 设置按钮 */}
              <div className="flex items-center gap-2">
                 <div className="flex items-center gap-1 text-xs text-green-600 font-medium bg-green-50 px-2 py-1 rounded-full">
                    <Check size={12} />
                    <span>Ready</span>
                 </div>
                 <button className="p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md transition-colors" title="设置">
                    <Settings size={16} />
                 </button>
              </div>
            </div>

            {/* 3. AI 面板主体内容 (Split View) */}
            <div className="flex-1 flex overflow-hidden relative">
              
              {/* A. 内部左侧：会话列表栏 (可折叠) */}
              <div 
                className={`flex flex-col border-r border-gray-100 bg-gray-50/50 transition-all duration-300 ease-in-out ${
                  isListExpanded ? 'w-48' : 'w-12'
                }`}
              >
                {/* 列表头部：新建按钮与折叠开关 */}
                <div className="p-2 border-b border-gray-100 flex flex-col gap-2 items-center">
                   {/* 折叠/展开 按钮 */}
                   <button 
                     onClick={() => setIsListExpanded(!isListExpanded)}
                     className="p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors w-full flex justify-center"
                     title={isListExpanded ? "收起列表" : "展开列表"}
                   >
                     {isListExpanded ? <PanelRightClose size={18}/> : <PanelRightOpen size={18}/>}
                   </button>

                   {/* 新建按钮 */}
                   <button className={`flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all shadow-blue-200 shadow-sm ${
                     isListExpanded ? 'w-full py-2 px-3' : 'w-8 h-8 rounded-full'
                   }`}>
                     <Plus size={18} />
                     {isListExpanded && <span className="text-xs font-bold whitespace-nowrap">新建对话</span>}
                   </button>
                </div>

                {/* 列表内容区 */}
                <div className="flex-1 overflow-y-auto py-2 custom-scrollbar">
                  {historyItems.map((item) => (
                    <div 
                      key={item.id} 
                      className={`group flex items-center px-2 py-3 cursor-pointer hover:bg-white hover:shadow-sm transition-all border-l-2 ${
                        item.id === 1 ? 'border-blue-500 bg-white' : 'border-transparent'
                      }`}
                      title={item.title}
                    >
                      <div className="min-w-[32px] flex justify-center relative">
                        {/* 根据 type 显示不同图标 */}
                        {item.type === 'agent' ? (
                           <Bot size={16} className={item.id === 1 ? 'text-blue-500' : 'text-purple-500'} />
                        ) : (
                           <MessageSquare size={16} className={item.id === 1 ? 'text-blue-500' : 'text-gray-400'} />
                        )}
                      </div>
                      
                      {/* 文字标签：只有展开时才显示 */}
                      <div className={`flex-1 overflow-hidden transition-opacity duration-200 ${
                        isListExpanded ? 'opacity-100 ml-1' : 'opacity-0 w-0 hidden'
                      }`}>
                        <p className={`text-xs truncate ${item.id === 1 ? 'text-gray-800 font-medium' : 'text-gray-500'}`}>
                          {item.title}
                        </p>
                        {/* Agent 类型标签 */}
                        {item.type === 'agent' && (
                           <span className="text-[10px] text-purple-600 bg-purple-50 px-1.5 rounded-full inline-block mt-1 transform scale-90 origin-left border border-purple-100">
                             Agent
                           </span>
                        )}
                      </div>
                      
                      {/* 删除按钮 */}
                      {isListExpanded && (
                        <button className="opacity-0 group-hover:opacity-100 text-gray-300 hover:text-red-500 p-1 transition-opacity">
                          <Trash2 size={12} />
                        </button>
                      )}
                    </div>
                  ))}
                </div>
                
                {/* 底部功能 (清空等) */}
                {isListExpanded && (
                  <div className="p-2 border-t border-gray-100 text-center">
                     <button className="text-xs text-gray-400 hover:text-gray-600 flex items-center justify-center gap-1 w-full py-1">
                       <Trash2 size={12}/> 清空历史
                     </button>
                  </div>
                )}
              </div>


              {/* B. 内部右侧：对话主窗口 */}
              <div className="flex-1 flex flex-col bg-white h-full relative">
                
                {/* 对话头部信息 */}
                <div className="h-12 border-b border-gray-50 flex items-center justify-between px-4 bg-white/95 backdrop-blur sticky top-0 z-10">
                  <div className="flex items-center gap-2">
                     <div className="w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center text-white text-[10px] font-bold">
                       L
                     </div>
                     <span className="text-sm font-bold text-gray-700">Lumina Agent</span>
                  </div>
                  <button className="text-xs text-gray-400 hover:text-blue-600 flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-full transition-colors border border-transparent hover:border-blue-100">
                     <Edit3 size={10} /> 编辑助手
                  </button>
                </div>

                {/* 聊天内容滚动区 */}
                <div className="flex-1 overflow-y-auto p-4 space-y-6">
                  {/* 欢迎消息 */}
                  <div className="flex gap-3">
                    <div className="w-8 h-8 rounded-full bg-blue-100 flex-shrink-0 flex items-center justify-center text-blue-600">
                      <Bot size={18} />
                    </div>
                    <div className="space-y-1">
                      <div className="bg-gray-50 p-3 rounded-2xl rounded-tl-none text-sm text-gray-600 leading-relaxed max-w-[90%]">
                        你好！我是你的笔记助手。点击左侧的 
                        <span className="inline-block mx-1 align-middle bg-blue-600 rounded-full w-4 h-4 text-center leading-4 text-white text-[10px]"><Plus size={10} className="inline"/></span>
                        可以开始新对话。列表默认折叠以保持专注。
                      </div>
                      <div className="text-[10px] text-gray-300 pl-1">刚刚</div>
                    </div>
                  </div>

                   {/* 用户消息示例 */}
                   <div className="flex gap-3 flex-row-reverse">
                    <div className="w-8 h-8 rounded-full bg-gray-200 flex-shrink-0 flex items-center justify-center text-gray-500">
                      <span className="text-xs font-bold">Me</span>
                    </div>
                    <div className="space-y-1 text-right">
                      <div className="bg-blue-600 p-3 rounded-2xl rounded-tr-none text-sm text-white leading-relaxed inline-block text-left">
                        帮我把这部分界面调整得更美观一点，特别是历史记录部分。
                      </div>
                    </div>
                  </div>
                </div>

                {/* 底部输入框 */}
                <div className="p-4 bg-white border-t border-gray-50">
                   <div className="relative">
                     <textarea 
                       value={inputText}
                       onChange={(e) => setInputText(e.target.value)}
                       placeholder="输入指令..." 
                       className="w-full bg-gray-50 border-transparent focus:bg-white focus:border-blue-200 focus:ring-2 focus:ring-blue-50 rounded-xl resize-none py-3 px-4 pr-12 text-sm min-h-[50px] transition-all"
                     />
                     <button className={`absolute right-2 bottom-2 p-1.5 rounded-lg transition-all ${
                       inputText ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-400'
                     }`}>
                       <Send size={16} />
                     </button>
                   </div>
                </div>

              </div>

            </div>
          </>
        ) : (
          /* 其他 Tab (大纲、链接、标签) 的空状态 */
          <div className="flex-1 flex flex-col items-center justify-center text-gray-300 bg-gray-50/30">
            <div className="flex flex-col items-center gap-3">
              <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-sm">
                {activeTab === 'Outline' && <List size={32} strokeWidth={1.5} className="text-gray-400" />}
                {activeTab === 'Links' && <LinkIcon size={32} strokeWidth={1.5} className="text-gray-400" />}
                {activeTab === 'Tags' && <Tag size={32} strokeWidth={1.5} className="text-gray-400" />}
              </div>
              <p className="text-sm font-medium text-gray-400">
                暂无{navItems.find(i => i.id === activeTab)?.label}内容
              </p>
            </div>
          </div>
        )}

      </div>
    </div>
  );
};

export default RightSidebarAI;